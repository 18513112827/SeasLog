<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Seaslog : A effective,fast,stable log extension for PHP" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Seaslog</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/Neeke/SeasLog">View on GitHub</a>

          <h1 id="project_title">Seaslog</h1>
          <h2 id="project_tagline">A effective,fast,stable log extension for PHP</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/Neeke/SeasLog/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/Neeke/SeasLog/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="seaslog" class="anchor" href="#seaslog"><span class="octicon octicon-link"></span></a>SeasLog</h1>

<p>A effective,fast,stable log extension for PHP
<a href="https://github.com/author" class="user-mention">@author</a> Chitao.Gao [<a href="mailto:neeke@php.net">neeke@php.net</a>]</p>

<blockquote>
<hr>
<ul>
<li>
<strong><a href="#%E7%AE%80%E4%BB%8B">简介</a></strong>

<ul>
<li><strong><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8seaslog">为什么使用SeasLog</a></strong></li>
<li><strong><a href="#%E7%9B%AE%E5%89%8D%E6%8F%90%E4%BE%9B%E4%BA%86%E4%BB%80%E4%B9%88">目前提供了什么</a></strong></li>
<li><strong><a href="#%E7%9B%AE%E6%A0%87%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84">目标是怎样的</a></strong></li>
</ul>
</li>
<li>
<strong><a href="#%E5%AE%89%E8%A3%85">安装</a></strong>

<ul>
<li><strong><a href="#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85-seaslog">编译安装 SeasLog</a></strong></li>
<li><strong><a href="#seaslogini%E7%9A%84%E9%85%8D%E7%BD%AE">seaslog.ini的配置</a></strong></li>
</ul>
</li>
<li>
<strong><a href="#%E4%BD%BF%E7%94%A8">使用</a></strong>

<ul>
<li>
<strong><a href="#%E5%B8%B8%E9%87%8F%E4%B8%8E%E5%87%BD%E6%95%B0">常量与函数</a></strong>

<ul>
<li><a href="#%E5%B8%B8%E9%87%8F%E5%88%97%E8%A1%A8">常量列表</a></li>
<li><a href="#%E5%87%BD%E6%95%B0%E5%88%97%E8%A1%A8">函数列表</a></li>
</ul>
</li>
<li>
<strong><a href="#seaslog-logger%E7%9A%84%E4%BD%BF%E7%94%A8">SeasLog Logger的使用</a></strong>

<ul>
<li><a href="#%E8%8E%B7%E5%8F%96%E4%B8%8E%E8%AE%BE%E7%BD%AEbasepath">获取与设置basePath</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AElogger%E4%B8%8E%E8%8E%B7%E5%8F%96lastlogger">设置logger与获取lastLogger</a></li>
<li><a href="#%E5%BF%AB%E9%80%9F%E5%86%99%E5%85%A5log">快速写入log</a></li>
</ul>
</li>
<li>
<strong><a href="#seaslog-analyzer%E7%9A%84%E4%BD%BF%E7%94%A8">SeasLog Analyzer的使用</a></strong>

<ul>
<li><a href="#%E5%BF%AB%E9%80%9F%E7%BB%9F%E8%AE%A1%E6%9F%90%E7%B1%BB%E5%9E%8Blog%E7%9A%84count%E5%80%BC">快速统计某类型log的count值</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E6%9F%90%E7%B1%BB%E5%9E%8Blog%E5%88%97%E8%A1%A8">获取某类型log列表</a></li>
</ul>
</li>
<li>
<strong><a href="#%E4%BD%BF%E7%94%A8seaslog%E8%BF%9B%E8%A1%8C%E5%81%A5%E5%BA%B7%E9%A2%84%E8%AD%A6">使用SeasLog进行健康预警</a></strong>

<ul>
<li><a href="#%E9%A2%84%E8%AD%A6%E7%9A%84%E9%85%8D%E7%BD%AE">预警的配置</a></li>
<li><a href="#crontab%E9%85%8D%E7%BD%AE">crontab配置</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
</blockquote>

<h2>
<a name="%E7%AE%80%E4%BB%8B" class="anchor" href="#%E7%AE%80%E4%BB%8B"><span class="octicon octicon-link"></span></a>简介</h2>

<h3>
<a name="%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8seaslog" class="anchor" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8seaslog"><span class="octicon octicon-link"></span></a>为什么使用SeasLog</h3>

<p>log日志，通常是系统或软件、应用的运行记录。通过log的分析，可以方便用户了解系统或软件、应用的运行情况；如果你的应用log足够丰富，也可以分析以往用户的操作行为、类型喜好、地域分布或其他更多信息；如果一个应用的log同时也分了多个级别，那么可以很轻易地分析得到该应用的健康状况，及时发现问题并快速定位、解决问题，补救损失。</p>

<p>php内置error_log、syslog函数功能强大且性能极好，但由于各种缺陷(error_log无错误级别、无固定格式，syslog不分模块、与系统日志混合)，灵活度降低了很多，不能满足应用需求。</p>

<p>好消息是，有不少第三方的log类库弥补了上述缺陷，如log4php、plog、Analog等(当然也有很多应用在项目中自己开发的log类)。其中以<a href="http://logging.apache.org/log4php/">log4php</a>最为著名，设计精良、格式完美、文档完善、功能强大。推荐。(log4php的性能有待测试)</p>

<p>那么有没有一种log类库满足以下需求呢：</p>

<ul>
<li>分模块、分级别</li>
<li>配置简单(最好是勿须配置)</li>
<li>日志格式清晰易读</li>
<li>应用简单、性能很棒</li>
</ul><p><code>SeasLog</code> 正是应此需求而生。</p>

<h3>
<a name="%E7%9B%AE%E5%89%8D%E6%8F%90%E4%BE%9B%E4%BA%86%E4%BB%80%E4%B9%88" class="anchor" href="#%E7%9B%AE%E5%89%8D%E6%8F%90%E4%BE%9B%E4%BA%86%E4%BB%80%E4%B9%88"><span class="octicon octicon-link"></span></a>目前提供了什么</h3>

<ul>
<li>在PHP项目中便捷、规范地记录log</li>
<li>可配置的默认log目录与模块</li>
<li>指定log目录与获取当前配置</li>
<li>初步的分析预警框架</li>
<li>高效的日志缓冲、便捷的缓冲debug</li>
</ul><h3>
<a name="%E7%9B%AE%E6%A0%87%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84" class="anchor" href="#%E7%9B%AE%E6%A0%87%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84"><span class="octicon octicon-link"></span></a>目标是怎样的</h3>

<ul>
<li>便捷、规范的log记录</li>
<li>高效的海量log分析</li>
<li>可配置、多途径的log预警</li>
</ul><h2>
<a name="%E5%AE%89%E8%A3%85" class="anchor" href="#%E5%AE%89%E8%A3%85"><span class="octicon octicon-link"></span></a>安装</h2>

<h3>
<a name="%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85-seaslog" class="anchor" href="#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85-seaslog"><span class="octicon octicon-link"></span></a>编译安装 seaslog</h3>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>/path/to/phpize
<span class="nv">$ </span>./configure --with-php-config<span class="o">=</span>/path/to/php-config
<span class="nv">$ </span>make <span class="o">&amp;&amp;</span> make install
</pre></div>

<h3>
<a name="seaslogini%E7%9A%84%E9%85%8D%E7%BD%AE" class="anchor" href="#seaslogini%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="octicon octicon-link"></span></a>seaslog.ini的配置</h3>

<div class="highlight highlight-conf"><pre>;<span class="w"> </span>configuration<span class="w"> </span>for<span class="w"> </span>php<span class="w"> </span>SeasLog<span class="w"> </span>module<span class="w"></span>
extension<span class="w"> </span>=<span class="w"> </span>seaslog.so<span class="w"></span>
seaslog.default_basepath<span class="w"> </span>=<span class="w"> </span>/log/seaslog-test<span class="w">    </span>;默认log根目录<span class="w"></span>
seaslog.default_logger<span class="w"> </span>=<span class="w"> </span><span class="no">default</span><span class="w">                </span>;默认logger目录<span class="w"></span>
seaslog.disting_type<span class="w"> </span>=<span class="w"> </span><span class="m">1</span><span class="w">                        </span>;是否以type分文件<span class="w"> </span><span class="m">1</span>是<span class="w"> </span><span class="m">0</span>否(默认)<span class="w"></span>
seaslog.disting_by_hour<span class="w"> </span>=<span class="w"> </span><span class="m">1</span><span class="w">                     </span>;是否每小时划分一个文件<span class="w"> </span><span class="m">1</span>是<span class="w"> </span><span class="m">0</span>否(默认)<span class="w"></span>
seaslog.use_buffer<span class="w"> </span>=<span class="w"> </span><span class="m">1</span><span class="w">                          </span>;是否启用buffer<span class="w"> </span><span class="m">1</span>是<span class="w"> </span><span class="m">0</span>否(默认)<span class="w"></span>
</pre></div>

<blockquote>
<p><code>seaslog.disting_type = 1</code> 开启以type分文件，即log文件区分info\warn\erro</p>

<p><code>seaslog.disting_by_hour = 1</code> 开启每小时划分一个文件</p>

<p><code>seaslog.use_buffer = 1</code> 开启buffer。默认关闭。当开启此项时，日志预存于内存，当请求结束时(或异常退出时)一次写入文件。</p>
</blockquote>

<h2>
<a name="%E4%BD%BF%E7%94%A8" class="anchor" href="#%E4%BD%BF%E7%94%A8"><span class="octicon octicon-link"></span></a>使用</h2>

<h3>
<a name="%E5%B8%B8%E9%87%8F%E4%B8%8E%E5%87%BD%E6%95%B0" class="anchor" href="#%E5%B8%B8%E9%87%8F%E4%B8%8E%E5%87%BD%E6%95%B0"><span class="octicon octicon-link"></span></a>常量与函数</h3>

<h4>
<a name="%E5%B8%B8%E9%87%8F%E5%88%97%E8%A1%A8" class="anchor" href="#%E5%B8%B8%E9%87%8F%E5%88%97%E8%A1%A8"><span class="octicon octicon-link"></span></a>常量列表</h4>

<p><code>SeasLog 共将日志分成8个级别</code></p>

<ul>
<li>SEASLOG_DEBUG                       "debug"</li>
<li>SEASLOG_INFO                        "info"</li>
<li>SEASLOG_NOTICE                      "notice"</li>
<li>SEASLOG_WARNING                     "warning"</li>
<li>SEASLOG_ERROR                       "error"</li>
<li>SEASLOG_CRITICAL                    "critical"</li>
<li>SEASLOG_ALERT                       "alert"</li>
<li>SEASLOG_EMERGENCY                   "emergency"</li>
</ul><div class="highlight highlight-php"><pre><span class="nb">var_dump</span><span class="p">(</span><span class="nx">SEASLOG_DEBUG</span><span class="p">,</span><span class="nx">SEASLOG_INFO</span><span class="p">,</span><span class="nx">SEASLOG_NOTICE</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">string('debug') debug级别</span>
<span class="cm">string('info')  info级别</span>
<span class="cm">string('notice') notice级别</span>
<span class="cm">*/</span>
</pre></div>

<h4>
<a name="%E5%87%BD%E6%95%B0%E5%88%97%E8%A1%A8" class="anchor" href="#%E5%87%BD%E6%95%B0%E5%88%97%E8%A1%A8"><span class="octicon octicon-link"></span></a>函数列表</h4>

<p><code>SeasLog</code> 提供了这样一组函数，可以方便地获取与设置根目录、模块目录、快速写入与统计log。
相信从下述伪代码的注释中，您可以快速获取函数信息，具体使用将紧接其后：</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="sd">/**</span>
<span class="sd"> * @author ciogao@gmail.com</span>
<span class="sd"> * Date: 14-1-27 下午4:47</span>
<span class="sd"> */</span>

<span class="k">class</span> <span class="nc">SeasLog</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">#SeasLog init</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__destruct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">#SeasLog distroy</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 设置basePath</span>
<span class="sd">     * @param $basePath</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">setBasePath</span><span class="p">(</span><span class="nv">$basePath</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 获取basePath</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getBasePath</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'the base_path'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 设置模块目录</span>
<span class="sd">     * @param $module</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">setLogger</span><span class="p">(</span><span class="nv">$module</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 获取最后一次设置的模块目录</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getLastLogger</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'the lastLogger'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 统计所有类型（或单个类型）行数</span>
<span class="sd">     * @param $level</span>
<span class="sd">     * @param string $log_path</span>
<span class="sd">     * @return array | long</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">analyzerCount</span><span class="p">(</span><span class="nv">$level</span> <span class="o">=</span> <span class="s1">'all'</span><span class="p">,</span><span class="nv">$log_path</span> <span class="o">=</span> <span class="s1">'*'</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 以数组形式，快速取出某类型log的各行详情</span>
<span class="sd">     * @param $level</span>
<span class="sd">     * @param string $log_path</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">analyzerDetail</span><span class="p">(</span><span class="nv">$level</span> <span class="o">=</span> <span class="nx">SEASLOG_INFO</span><span class="p">,</span><span class="nv">$log_path</span> <span class="o">=</span> <span class="s1">'*'</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 获得当前日志buffer中的内容</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getBuffer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 记录debug日志</span>
<span class="sd">     * @param $message</span>
<span class="sd">     * @param array $content</span>
<span class="sd">     * @param string $module</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">debug</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="k">array</span> <span class="nv">$content</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span><span class="nv">$module</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">#$level = SEASLOG_DEBUG</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 记录info日志</span>
<span class="sd">     * @param $message</span>
<span class="sd">     * @param array $content</span>
<span class="sd">     * @param string $module</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">info</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="k">array</span> <span class="nv">$content</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span><span class="nv">$module</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">#$level = SEASLOG_INFO</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 记录notice日志</span>
<span class="sd">     * @param $message</span>
<span class="sd">     * @param array $content</span>
<span class="sd">     * @param string $module</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">notice</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="k">array</span> <span class="nv">$content</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span><span class="nv">$module</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">#$level = SEASLOG_NOTICE</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 记录warning日志</span>
<span class="sd">     * @param $message</span>
<span class="sd">     * @param array $content</span>
<span class="sd">     * @param string $module</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">warning</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="k">array</span> <span class="nv">$content</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span><span class="nv">$module</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">#$level = SEASLOG_WARNING</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 记录error日志</span>
<span class="sd">     * @param $message</span>
<span class="sd">     * @param array $content</span>
<span class="sd">     * @param string $module</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">error</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="k">array</span> <span class="nv">$content</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span><span class="nv">$module</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">#$level = SEASLOG_ERROR</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 记录critical日志</span>
<span class="sd">     * @param $message</span>
<span class="sd">     * @param array $content</span>
<span class="sd">     * @param string $module</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">critical</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="k">array</span> <span class="nv">$content</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span><span class="nv">$module</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">#$level = SEASLOG_CRITICAL</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 记录alert日志</span>
<span class="sd">     * @param $message</span>
<span class="sd">     * @param array $content</span>
<span class="sd">     * @param string $module</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">alert</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="k">array</span> <span class="nv">$content</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span><span class="nv">$module</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">#$level = SEASLOG_ALERT</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 记录emergency日志</span>
<span class="sd">     * @param $message</span>
<span class="sd">     * @param array $content</span>
<span class="sd">     * @param string $module</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">emergency</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="k">array</span> <span class="nv">$content</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span><span class="nv">$module</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">#$level = SEASLOG_EMERGENCY</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 通用日志方法</span>
<span class="sd">     * @param $level</span>
<span class="sd">     * @param $message</span>
<span class="sd">     * @param array $content</span>
<span class="sd">     * @param string $module</span>
<span class="sd">     */</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">log</span><span class="p">(</span><span class="nv">$level</span><span class="p">,</span><span class="nv">$message</span><span class="p">,</span><span class="k">array</span> <span class="nv">$content</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span><span class="nv">$module</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span>
    <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>


</pre></div>

<h3>
<a name="seaslog-logger%E7%9A%84%E4%BD%BF%E7%94%A8" class="anchor" href="#seaslog-logger%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="octicon octicon-link"></span></a>SeasLog Logger的使用</h3>

<h4>
<a name="%E8%8E%B7%E5%8F%96%E4%B8%8E%E8%AE%BE%E7%BD%AEbasepath" class="anchor" href="#%E8%8E%B7%E5%8F%96%E4%B8%8E%E8%AE%BE%E7%BD%AEbasepath"><span class="octicon octicon-link"></span></a>获取与设置basePath</h4>

<div class="highlight highlight-php"><pre><span class="nv">$basePath_1</span> <span class="o">=</span> <span class="nx">SeasLog</span><span class="o">::</span><span class="na">getBasePath</span><span class="p">();</span>

<span class="nx">SeasLog</span><span class="o">::</span><span class="na">setBasePath</span><span class="p">(</span><span class="s1">'/log/base_test'</span><span class="p">);</span>
<span class="nv">$basePath_2</span> <span class="o">=</span> <span class="nx">SeasLog</span><span class="o">::</span><span class="na">getBasePath</span><span class="p">();</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$basePath_1</span><span class="p">,</span><span class="nv">$basePath_2</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">string(19) "/log/seaslog-ciogao"</span>
<span class="cm">string(14) "/log/base_test"</span>
<span class="cm">*/</span>
</pre></div>

<blockquote>
<p>直接使用 <code>SeasLog::getBasePath()</code>，将获取php.ini(seaslog.ini)中设置的 <code>seaslog.default_basepath</code> 的值。</p>

<p>使用 <code>SeasLog::getBasePath()</code> 函数，将改变 <code>seaslog_get_basepath()</code> 的取值。</p>
</blockquote>

<h4>
<a name="%E8%AE%BE%E7%BD%AElogger%E4%B8%8E%E8%8E%B7%E5%8F%96lastlogger" class="anchor" href="#%E8%AE%BE%E7%BD%AElogger%E4%B8%8E%E8%8E%B7%E5%8F%96lastlogger"><span class="octicon octicon-link"></span></a>设置logger与获取lastLogger</h4>

<div class="highlight highlight-php"><pre><span class="nv">$lastLogger_1</span> <span class="o">=</span> <span class="nx">SeasLog</span><span class="o">::</span><span class="na">getLastLogger</span><span class="p">();</span>

<span class="nx">SeasLog</span><span class="o">::</span><span class="na">setLogger</span><span class="p">(</span><span class="s1">'testModule/app1'</span><span class="p">);</span>
<span class="nv">$lastLogger_2</span> <span class="o">=</span> <span class="nx">SeasLog</span><span class="o">::</span><span class="na">getLastLogger</span><span class="p">();</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$lastLogger_1</span><span class="p">,</span><span class="nv">$lastLogger_2</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">string(7) "default"</span>
<span class="cm">string(15) "testModule/app1"</span>
<span class="cm">*/</span>
</pre></div>

<blockquote>
<p>与basePath相类似的，</p>

<p>直接使用 <code>SeasLog::getLastLogger()</code>，将获取php.ini(seaslog.ini)中设置的 <code>seaslog.default_logger</code> 的值。</p>

<p>使用 <code>SeasLog::setLogger()</code> 函数，将改变 <code>SeasLog::getLastLogger()</code> 的取值。</p>
</blockquote>

<h4>
<a name="%E5%BF%AB%E9%80%9F%E5%86%99%E5%85%A5log" class="anchor" href="#%E5%BF%AB%E9%80%9F%E5%86%99%E5%85%A5log"><span class="octicon octicon-link"></span></a>快速写入log</h4>

<p>上面已经设置过了basePath与logger，于是log记录的目录已经产生了，</p>

<blockquote>
<p>log记录目录 = basePath / logger / {fileName}.log
log文件名，以 <code>年月日</code> 分文件，如今天是2014年02月18日期，那么 <code>{fileName}</code> = <code>20140218</code>;</p>
</blockquote>

<p>还记得 <code>php.ini</code> 中设置的 <code>seaslog.disting_type</code> 吗？</p>

<p>默认的 <code>seaslog.disting_type = 0</code>，如果今天我使用了 <code>SeasLog</code> ，那么将产生最终的log文件：</p>

<ul>
<li>LogFile = basePath / logger / 20140218.log</li>
</ul><p>如果 <code>seaslog.disting_type = 1</code>，则最终的log文件将是这样的三个文件</p>

<ul>
<li><p>infoLogFile = basePath / logger / INFO.20140218.log</p></li>
<li><p>warnLogFile = basePath / logger / WARN.20140218.log</p></li>
<li><p>erroLogFile = basePath / logger / ERRO.20140218.log</p></li>
</ul><div class="highlight highlight-php"><pre>
<span class="nx">SeasLog</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="nx">SEASLOG_ERROR</span><span class="p">,</span><span class="s1">'this is a error test by ::log'</span><span class="p">);</span>

<span class="nx">SeasLog</span><span class="o">::</span><span class="na">debug</span><span class="p">(</span><span class="s1">'this is a {userName} debug'</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">'{userName}'</span> <span class="o">=&gt;</span> <span class="s1">'neeke'</span><span class="p">));</span>

<span class="nx">SeasLog</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s1">'this is a info log'</span><span class="p">);</span>

<span class="nx">SeasLog</span><span class="o">::</span><span class="na">notice</span><span class="p">(</span><span class="s1">'this is a notice log'</span><span class="p">);</span>

<span class="nx">SeasLog</span><span class="o">::</span><span class="na">warning</span><span class="p">(</span><span class="s1">'your {website} was down,please {action} it ASAP!'</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">'{website}'</span> <span class="o">=&gt;</span> <span class="s1">'github.com'</span><span class="p">,</span><span class="s1">'{action}'</span> <span class="o">=&gt;</span> <span class="s1">'rboot'</span><span class="p">));</span>

<span class="nx">SeasLog</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="s1">'a error log'</span><span class="p">);</span>

<span class="nx">SeasLog</span><span class="o">::</span><span class="na">critical</span><span class="p">(</span><span class="s1">'some thing was critical'</span><span class="p">);</span>

<span class="nx">SeasLog</span><span class="o">::</span><span class="na">alert</span><span class="p">(</span><span class="s1">'yes this is a {messageName}'</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">'{messageName}'</span> <span class="o">=&gt;</span> <span class="s1">'alertMSG'</span><span class="p">));</span>

<span class="nx">SeasLog</span><span class="o">::</span><span class="na">emergency</span><span class="p">(</span><span class="s1">'Just now, the house next door was completely burnt out! {note}'</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">'{note}'</span> <span class="o">=&gt;</span> <span class="s1">'it`s a joke'</span><span class="p">));</span>

<span class="cm">/*</span>
<span class="cm">这些函数同时也接受第3个参数为logger的设置项</span>
<span class="cm">注意，当last_logger == 'default'时等同于:</span>
<span class="cm">seaslog_set_logger('test/new/path');</span>
<span class="cm">seaslog('test error 3', SEASLOG_TYPE_ERRO);</span>
<span class="cm">如果已经在前文使用过seaslog_set_logger函数，第3个参数的log只在此处临时使用，不影响下文。</span>
<span class="cm">*/</span>
</pre></div>

<blockquote>
<p>log格式统一为： <code>{type} | {pid} | {timeStamp} |{dateTime} | {logInfo}</code></p>

<div class="highlight highlight-sh"><pre>error <span class="p">|</span> <span class="m">23625</span> <span class="p">|</span> 1406422432.786 <span class="p">|</span> 2014:07:27 08:53:52 <span class="p">|</span> this is a error <span class="nb">test </span>by ::log
</pre></div>
</blockquote>

<p>debug | 23625 | 1406422432.786 | 2014:07:27 08:53:52 | this is a neeke debug</p>

<p>info | 23625 | 1406422432.787 | 2014:07:27 08:53:52 | this is a info log</p>

<p>notice | 23625 | 1406422432.787 | 2014:07:27 08:53:52 | this is a notice log</p>

<p>warning | 23625 | 1406422432.787 | 2014:07:27 08:53:52 | your github.com was down,please rboot it ASAP!</p>

<p>error | 23625 | 1406422432.787 | 2014:07:27 08:53:52 | a error log</p>

<p>critical | 23625 | 1406422432.787 | 2014:07:27 08:53:52 | some thing was critical</p>

<p>emergency | 23625 | 1406422432.787 | 2014:07:27 08:53:52 | Just now, the house next door was completely burnt out! it`s a joke</p>

<pre><code>
### SeasLog Analyzer的使用
#### 快速统计某类型log的count值
`SeasLog`在扩展中使用管道调用shell命令 `grep -wc`快速地取得count值，并返回值(array || int)给PHP。
```php
$countResult_1 = SeasLog::analyzerCount();
$countResult_2 = SeasLog::analyzerCount(SEASLOG_WARNING);
$countResult_3 = SeasLog::analyzerCount(SEASLOG_ERRO,date('Ymd',time()));

var_dump($countResult_1,$countResult_2,$countResult_3);
/*
array(8) {
  ["debug"]=&gt;
  int(3)
  ["info"]=&gt;
  int(3)
  ["notice"]=&gt;
  int(3)
  ["warning"]=&gt;
  int(3)
  ["error"]=&gt;
  int(6)
  ["critical"]=&gt;
  int(3)
  ["alert"]=&gt;
  int(3)
  ["emergency"]=&gt;
  int(3)
}


int(7)

int(1)

*/
</code></pre>

<h4>
<a name="%E8%8E%B7%E5%8F%96%E6%9F%90%E7%B1%BB%E5%9E%8Blog%E5%88%97%E8%A1%A8" class="anchor" href="#%E8%8E%B7%E5%8F%96%E6%9F%90%E7%B1%BB%E5%9E%8Blog%E5%88%97%E8%A1%A8"><span class="octicon octicon-link"></span></a>获取某类型log列表</h4>

<p><code>SeasLog</code>在扩展中使用管道调用shell命令 <code>grep -w</code>快速地取得列表，并返回array给PHP。</p>

<div class="highlight highlight-php"><pre><span class="nv">$detailErrorArray_inAll</span>   <span class="o">=</span> <span class="nx">SeasLog</span><span class="o">::</span><span class="na">analyzerDetail</span><span class="p">(</span><span class="nx">SEASLOG_ERRO</span><span class="p">);</span>
<span class="nv">$detailErrorArray_today</span>   <span class="o">=</span> <span class="nx">SeasLog</span><span class="o">::</span><span class="na">analyzerDetail</span><span class="p">(</span><span class="nx">SEASLOG_ERRO</span><span class="p">,</span><span class="nb">date</span><span class="p">(</span><span class="s1">'Ymd'</span><span class="p">,</span><span class="nb">time</span><span class="p">()));</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$detailErrorArray_inAll</span><span class="p">,</span><span class="nv">$detailErrorArray_today</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">SeasLog::analyzerDetail(SEASLOG_ERRO) == SeasLog::analyzerDetail(SEASLOG_ERRO,'*');</span>
<span class="cm">取当前模块下所有level为 SEASLOG_ERRO 的信息列表:</span>
<span class="cm">array(6) {</span>
<span class="cm"> [0] =&gt;</span>
<span class="cm">  string(66) "ERRO | 8568 | 1393172042.717 | 2014:02:24 00:14:02 | test error 3 "</span>
<span class="cm">  [1] =&gt;</span>
<span class="cm">  string(66) "ERRO | 8594 | 1393172044.104 | 2014:02:24 00:14:04 | test error 3 "</span>
<span class="cm">  [2] =&gt;</span>
<span class="cm">  string(66) "ERRO | 8620 | 1393172044.862 | 2014:02:24 00:14:04 | test error 3 "</span>
<span class="cm">  [3] =&gt;</span>
<span class="cm">  string(66) "ERRO | 8646 | 1393172045.989 | 2014:02:24 00:14:05 | test error 3 "</span>
<span class="cm">  [4] =&gt;</span>
<span class="cm">  string(66) "ERRO | 8672 | 1393172047.882 | 2014:02:24 00:14:07 | test error 3 "</span>
<span class="cm">  [5] =&gt;</span>
<span class="cm">  string(66) "ERRO | 8698 | 1393172048.736 | 2014:02:24 00:14:08 | test error 3 "</span>
<span class="cm">}</span>

<span class="cm">SeasLog::analyzerDetail(SEASLOG_ERRO,date('Ymd',time()));</span>
<span class="cm">只取得当前模块下，当前一天内,level为SEASLOG_ERRO 的信息列表:</span>
<span class="cm">array(2) {</span>
<span class="cm">  [0] =&gt;</span>
<span class="cm">  string(66) "ERRO | 8568 | 1393172042.717 | 2014:02:24 00:14:02 | test error 3 "</span>
<span class="cm">  [1] =&gt;</span>
<span class="cm">  string(66) "ERRO | 8594 | 1393172044.104 | 2014:02:24 00:14:04 | test error 3 "</span>
<span class="cm">}</span>

<span class="cm">同理，取当月 </span>
<span class="cm">$detailErrorArray_mouth = SeasLog::analyzerDetail(SEASLOG_ERRO,date('Ym',time()));</span>

<span class="cm">*/</span>
</pre></div>

<h3>
<a name="%E4%BD%BF%E7%94%A8seaslog%E8%BF%9B%E8%A1%8C%E5%81%A5%E5%BA%B7%E9%A2%84%E8%AD%A6" class="anchor" href="#%E4%BD%BF%E7%94%A8seaslog%E8%BF%9B%E8%A1%8C%E5%81%A5%E5%BA%B7%E9%A2%84%E8%AD%A6"><span class="octicon octicon-link"></span></a>使用SeasLog进行健康预警</h3>

<h4>
<a name="%E9%A2%84%E8%AD%A6%E7%9A%84%E9%85%8D%E7%BD%AE" class="anchor" href="#%E9%A2%84%E8%AD%A6%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="octicon octicon-link"></span></a>预警的配置</h4>

<div class="highlight highlight-conf"><pre>[base]<span class="w"></span>
wait_analyz_log_path<span class="w"> </span>=<span class="w"> </span>/log/base_test<span class="w"></span>

[fork]<span class="w"></span>
;是否开启多线程<span class="w"> </span><span class="m">1</span>开启<span class="w"> </span><span class="m">0</span>关闭<span class="w"></span>
fork_open<span class="w"> </span>=<span class="w"> </span><span class="m">1</span><span class="w"></span>

;线程个数<span class="w"></span>
fork_count<span class="w"> </span>=<span class="w"> </span><span class="m">3</span><span class="w"></span>

[warning]<span class="w"></span>
email[smtp_host]<span class="w"> </span>=<span class="w"> </span>smtp.163.com<span class="w"></span>
email[smtp_port]<span class="w"> </span>=<span class="w"> </span><span class="m">25</span><span class="w"></span>
email[subject_pre]<span class="w"> </span>=<span class="w"> </span>预警邮件<span class="w"> </span>-<span class="w"></span>
email[smtp_user]<span class="w"> </span>=<span class="w"> </span>seaslogdemo@163.com<span class="w"></span>
email[smtp_pwd]<span class="w"> </span>=<span class="w"> </span>seaslog#demo<span class="w"></span>
email[mail_from]<span class="w"> </span>=<span class="w"> </span>seaslogdemo@163.com<span class="w"></span>
email[mail_to]<span class="w"> </span>=<span class="w"> </span>gaochitao@weiboyi.com<span class="w"></span>
email[mail_cc]<span class="w"> </span>=<span class="w"> </span>ciogao@gmail.com<span class="w"></span>
email[mail_bcc]<span class="w"> </span>=<span class="w"></span>

[analyz]<span class="w"></span>
;<span class="w"> </span>enum<span class="w"></span>
;<span class="w"> </span>SEASLOG_DEBUG<span class="w">      </span>"debug"<span class="w"></span>
;<span class="w"> </span>SEASLOG_INFO<span class="w">       </span>"info"<span class="w"></span>
;<span class="w"> </span>SEASLOG_NOTICE<span class="w">     </span>"notice"<span class="w"></span>
;<span class="w"> </span>SEASLOG_WARNING<span class="w">    </span>"warning"<span class="w"></span>
;<span class="w"> </span>SEASLOG_ERROR<span class="w">      </span>"error"<span class="w"></span>
;<span class="w"> </span>SEASLOG_CRITICAL<span class="w">   </span>"critical"<span class="w"></span>
;<span class="w"> </span>SEASLOG_ALERT<span class="w">      </span>"alert"<span class="w"></span>
;<span class="w"> </span>SEASLOG_EMERGENCY<span class="w">  </span>"emergency"<span class="w"></span>

test1[module]<span class="w"> </span>=<span class="w"> </span>test/bb<span class="w"></span>
test1[level]<span class="w"> </span>=<span class="w"> </span>SEASLOG_ERROR<span class="w"></span>
test1[bar]<span class="w"> </span>=<span class="w"> </span><span class="m">1</span><span class="w"></span>
test1[mail_to]<span class="w"> </span>=<span class="w"> </span>gaochitao@weiboyi.com<span class="w"></span>

test2[module]<span class="w"> </span>=<span class="w"> </span><span class="m">222</span><span class="w"></span>
test2[level]<span class="w"> </span>=<span class="w"> </span>SEASLOG_WARNING<span class="w"></span>

test3[module]<span class="w"> </span>=<span class="w"> </span><span class="m">333</span><span class="w"></span>
test3[level]<span class="w"> </span>=<span class="w"> </span>SEASLOG_CRITICAL<span class="w"></span>

test4[module]<span class="w"> </span>=<span class="w"> </span><span class="m">444</span><span class="w"></span>
test4[level]<span class="w"> </span>=<span class="w"> </span>SEASLOG_EMERGENCY<span class="w"></span>

test5[module]<span class="w"> </span>=<span class="w"> </span><span class="m">555</span><span class="w"></span>
test5[level]<span class="w"> </span>=<span class="w"> </span>SEASLOG_DEBUG<span class="w"></span>

</pre></div>

<h4>
<a name="crontab%E9%85%8D%E7%BD%AE" class="anchor" href="#crontab%E9%85%8D%E7%BD%AE"><span class="octicon octicon-link"></span></a>crontab配置</h4>

<div class="highlight highlight-conf"><pre>;每天凌晨3点执行<span class="w"></span>
<span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>/path/to/php<span class="w"> </span>/path/to/SeasLog/Analyzer/SeasLogAnalyzer.php<span class="w"></span>
</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Seaslog maintained by <a href="https://github.com/Neeke">Neeke</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
